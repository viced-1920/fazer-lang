// tools/announce.fz
webhook := "https://canary.discord.com/api/webhooks/1463728147202838652/vEd4MqqtYmAFg15GKX3FBxLYS1XImycormdOMwTa3Dbwcm6r8lYI3dfIWlZiLH2Dxq9e"

fn send(title, desc, color) ->
  payload := {
    "embeds": [{
      "title": title,
      "description": desc,
      "color": int(color),
      "footer": { "text": "Fazer Automation System" }
    }]
  }

  println("Envoi vers Discord...")
  res := fetch(webhook, {
    "method": "POST",
    "headers": { "Content-Type": "application/json" },
    "body": json(payload)
  })
  
  case res.status >= 200 and res.status < 300
    true -> println("SuccÃ¨s !") end
    else -> println("Erreur " + res.status + ": " + res.body) end
  end
end

a := argv()
start := 1

case len(a) <= start
  true -> println("Usage: fazer tools/announce.fz \"Titre\" \"Description\" [color]") end
  else ->
    title := a[start]
    desc := ""
    case len(a) > start + 1
      true -> desc := a[start + 1] end
      else -> end
    end
    
    color := 5763719
    case len(a) > start + 2
      true -> color := a[start + 2] end
      else -> end
    end
    
    send(title, desc, color)
  end
end
